{% extends 'base/layout.html' %}
{% block css %}
<link rel="stylesheet" href="/static/css/index.css">
<title>App Name</title>
{% endblock %}
{% block body %}

<h3> Welcome to Our Hosting Service! </h3>

<div id="create-application">
    <div class="container">
        <h5> Create an Application </h5>
        <form id="create-application-form">
            <div class="box">
                <div class="icon"><i class="fa fa-globe" aria-hidden="true"></i></div>
                <div class="form-group">
                    <label for="app_name"> Enter the Application Name </label>
                    <input name="app_name" id="app_name" required>
                </div>
            </div>
            <div class="box">
                <div class="icon"><i class="fa fa-link" aria-hidden="true"></i></div>
                <div class="form-group">
                    <label for="docker_image"> Enter the Docker Hub link </label>
                    <input name="docker_image" id="docker_image" required>
                </div>
            </div>
            <div class="box">
                <div class="form-group">
                    <button class="btn btn-success" type="submit"> Create </button>
                </div>
            </div>
        </form>
        <br>
        <div class="box">
            <div class="goto-logout-page">
                <a href="/logout" style="text-decoration:none"> Logout </a>
            </div>
        </div>
    </div>
</div>


<div class="websites">
    <h4> Our currently hosted websites </h4>

    <table>
        <thead>
            <td> app_name </td>
            <td> docker_image </td>
            <td> APP URL </td>
            <td> DashBoard </td>
            <td> provisioning </td>

        </thead>
        <tbody>
            {% for app in WORKING_APPLICATIONS %}
            <tr>
                <td> {{ app.app_name }} </td>
                <td> {{ app.docker_image }} </td>
                <td> {{ app.app_url }} </td>
                <td>
                    <a href="{{ app.dashboard_url }}"> {{ app.dashboard_url }} </a>
                </td>
                <td> {{ app }} </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}

{% block script %}

<script>
    document.getElementById("create-application-form").onsubmit = function (e) {
        e.preventDefault();

        const app_name = document.getElementById("app_name").value;
        const docker_image = document.getElementById("docker_image").value;

        fetch(`/create_application?app_name=${app_name}&docker_image=${docker_image}`)
            .then(res => res.json())
            .then(data => {
                console.log(data);

                location.reload();
            }).catch(err => {
                alert("Something went wrong" + err);
            });
    }
</script>

{% endblock %}